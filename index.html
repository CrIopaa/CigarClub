<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CigarClub - Social Network for Cigar Aficionados</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #FAFAF9;
            color: #1C1917;
            min-height: 100vh;
        }
        
        .cigar-app {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: #FFFFFF;
            border-bottom: 1px solid #E7E5E4;
            padding: 1.25rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: #1C1917;
            letter-spacing: -0.5px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        .nav-btn {
            background: transparent;
            border: none;
            color: #78716C;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .nav-btn:hover {
            background: #F5F5F4;
            color: #1C1917;
        }
        
        .nav-btn.active {
            background: #1C1917;
            color: #FFFFFF;
        }
        
        .create-post-btn {
            background: #1C1917;
            border: none;
            color: #FFFFFF;
            padding: 0.65rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .create-post-btn:hover {
            background: #292524;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Main Content */
        .main-content {
            padding: 2.5rem 2rem;
            max-width: 680px;
            margin: 0 auto;
        }
        
        /* Feed */
        .feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .post-card {
            background: #FFFFFF;
            border: 1px solid #E7E5E4;
            border-radius: 16px;
            padding: 1.75rem;
            transition: all 0.2s ease;
        }
        
        .post-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }
        
        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1C1917, #44403C);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            color: #FFFFFF;
        }
        
        .user-details h3 {
            font-family: 'Inter', sans-serif;
            color: #1C1917;
            margin-bottom: 0.2rem;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .timestamp {
            color: #78716C;
            font-size: 0.85rem;
        }
        
        .cigar-info {
            background: #F5F5F4;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.25rem;
            border-left: 3px solid #1C1917;
        }
        
        .cigar-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.35rem;
            color: #1C1917;
            margin-bottom: 0.4rem;
            font-weight: 700;
        }
        
        .brand-name {
            color: #78716C;
            font-size: 0.9rem;
            margin-bottom: 0.875rem;
            font-weight: 500;
        }
        
        .star-rating {
            display: flex;
            gap: 0.25rem;
        }
        
        .star {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .star.filled {
            fill: #1C1917;
            stroke: #1C1917;
        }
        
        .star.empty {
            fill: none;
            stroke: #A8A29E;
        }
        
        .post-comment {
            color: #44403C;
            line-height: 1.7;
            font-size: 0.95rem;
            margin-bottom: 1.25rem;
        }
        
        .post-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }
        
        .post-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .post-image:hover {
            transform: scale(1.02);
        }
        
        .post-actions {
            display: flex;
            gap: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #E7E5E4;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: transparent;
            border: none;
            color: #78716C;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
        }
        
        .action-btn:hover {
            color: #1C1917;
            background: #F5F5F4;
        }
        
        .delete-btn {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
            padding: 0.4rem 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .delete-btn:hover {
            background: #FCA5A5;
            color: #7F1D1D;
        }
        
        .post-header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: #FFFFFF;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.75rem;
        }
        
        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            color: #1C1917;
            font-weight: 700;
        }
        
        .close-btn {
            background: #F5F5F4;
            border: none;
            color: #78716C;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: #E7E5E4;
            color: #1C1917;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            color: #1C1917;
            margin-bottom: 0.6rem;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .form-select, .form-textarea {
            width: 100%;
            background: #FAFAF9;
            border: 1px solid #E7E5E4;
            border-radius: 10px;
            padding: 0.875rem;
            color: #1C1917;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }
        
        .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1C1917;
            background: #FFFFFF;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }
        
        .scan-section {
            background: #F5F5F4;
            border: 2px dashed #D6D3D1;
            border-radius: 12px;
            padding: 1.75rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .scan-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            background: #D6D3D1;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #1C1917;
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: #FFFFFF;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .toggle-switch.active .toggle-slider {
            left: 27px;
        }
        
        .upload-area {
            border: 2px dashed #D6D3D1;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 1rem;
            background: #FAFAF9;
        }
        
        .upload-area:hover {
            border-color: #1C1917;
            background: #FFFFFF;
        }
        
        .upload-input {
            display: none;
        }
        
        .scan-result {
            background: #F0FDF4;
            border: 1px solid #BBF7D0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            text-align: left;
        }
        
        .scanning {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            color: #1C1917;
            padding: 2rem;
        }
        
        .spinner {
            border: 3px solid #E7E5E4;
            border-top: 3px solid #1C1917;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .confidence-bar {
            background: #E7E5E4;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.75rem;
        }
        
        .confidence-fill {
            background: linear-gradient(90deg, #22C55E, #16A34A);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .google-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #1C1917;
            text-decoration: none;
            margin-top: 1rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            padding: 0.5rem 0.75rem;
            background: #FAFAF9;
            border-radius: 6px;
        }
        
        .google-link:hover {
            background: #E7E5E4;
        }
        
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .preview-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #E7E5E4;
        }
        
        .submit-btn {
            width: 100%;
            background: #1C1917;
            border: none;
            color: #FFFFFF;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s ease;
            margin-top: 1.5rem;
        }
        
        .submit-btn:hover:not(:disabled) {
            background: #292524;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Profile View */
        .profile {
            background: #FFFFFF;
            border: 1px solid #E7E5E4;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.75rem;
            margin-bottom: 2rem;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1C1917, #44403C);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 2.25rem;
            color: #FFFFFF;
        }
        
        .profile-info h1 {
            font-family: 'Playfair Display', serif;
            color: #1C1917;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .profile-stats {
            display: flex;
            gap: 2.5rem;
            margin-top: 1rem;
        }
        
        .stat {
            text-align: left;
        }
        
        .stat-number {
            font-family: 'Inter', sans-serif;
            font-size: 1.75rem;
            color: #1C1917;
            font-weight: 700;
        }
        
        .stat-label {
            color: #78716C;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: 500;
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .main-content {
                padding: 1.5rem 1rem;
            }
            
            .post-card {
                padding: 1.5rem;
            }
            
            .modal {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="cigar-app">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">CigarClub</div>
                <div class="nav-buttons">
                    <div style="position: relative; margin-right: 0.5rem;">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Search posts..." 
                            style="
                                padding: 0.5rem 2.5rem 0.5rem 1rem;
                                border: 1px solid #E7E5E4;
                                border-radius: 8px;
                                font-size: 0.9rem;
                                background: #FAFAF9;
                                color: #1C1917;
                                width: 200px;
                                transition: all 0.2s ease;
                            "
                        >
                        <svg 
                            style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none;"
                            width="16" 
                            height="16" 
                            viewBox="0 0 24 24" 
                            fill="none" 
                            stroke="#78716C" 
                            stroke-width="2"
                        >
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                    <button class="nav-btn active" id="feedBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Feed
                    </button>
                    <button class="nav-btn" id="profileBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Profile
                    </button>
                    <button class="create-post-btn" id="createPostBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        New Post
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Feed View -->
            <div id="feedView" class="feed"></div>

            <!-- Profile View -->
            <div id="profileView" class="profile hidden">
                <div class="profile-header">
                    <div class="profile-avatar">GU</div>
                    <div class="profile-info">
                        <h1>Guest User</h1>
                        <div class="profile-stats">
                            <div class="stat">
                                <div class="stat-number" id="reviewCount">0</div>
                                <div class="stat-label">Reviews</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="favoriteCount">0</div>
                                <div class="stat-label">Favorites</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="postCount">0</div>
                                <div class="stat-label">Posts</div>
                            </div>
                        </div>
                        <button class="create-post-btn" id="editProfileBtn" style="margin-top: 1.5rem; width: auto;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit Profile
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Post Modal -->
        <div class="modal-overlay" id="modalOverlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">Create Post</h2>
                    <button class="close-btn" id="closeModalBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <!-- Scan Section -->
                <div class="scan-section">
                    <div class="scan-toggle">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                            <path d="M5 3v4"></path>
                            <path d="M19 17v4"></path>
                            <path d="M3 5h4"></path>
                            <path d="M17 19h4"></path>
                        </svg>
                        <span style="color: #1C1917; font-weight: 600; font-size: 0.9rem;">AI Cigar Recognition</span>
                        <div class="toggle-switch" id="scanToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div id="scanDescription" class="hidden">
                        <p style="color: #78716C; margin-bottom: 1rem; font-size: 0.9rem;">
                            Upload a photo of the cigar band and we'll identify it
                        </p>
                    </div>
                    
                    <div id="scanningIndicator" class="hidden">
                        <div class="scanning">
                            <div class="spinner"></div>
                            <span>Analyzing cigar band...</span>
                        </div>
                    </div>
                    
                    <div id="scanResult" class="hidden"></div>
                </div>

                <!-- Image Upload -->
                <div class="form-group">
                    <label class="form-label">Photos (up to 5)</label>
                    <label class="upload-area" for="imageUpload">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#78716C" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <p style="margin-top: 0.875rem; color: #78716C; font-size: 0.9rem; font-weight: 500;">
                            Click to upload photos
                        </p>
                    </label>
                    <input type="file" id="imageUpload" class="upload-input" accept="image/*" multiple>
                    <div id="imagePreviewGrid" class="image-preview-grid hidden"></div>
                </div>

                <!-- Brand Selection -->
                <div class="form-group">
                    <label class="form-label">Brand</label>
                    <select class="form-select" id="brandSelect">
                        <option value="">Select a brand...</option>
                    </select>
                </div>

                <!-- Cigar Selection -->
                <div class="form-group hidden" id="cigarGroup">
                    <label class="form-label">Cigar</label>
                    <select class="form-select" id="cigarSelect">
                        <option value="">Select a cigar...</option>
                    </select>
                </div>

                <!-- Rating -->
                <div class="form-group">
                    <label class="form-label">Rating</label>
                    <div class="star-rating" id="ratingStars">
                        <svg class="star empty" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" data-rating="1">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <svg class="star empty" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" data-rating="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <svg class="star empty" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" data-rating="3">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <svg class="star empty" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" data-rating="4">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <svg class="star empty" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" data-rating="5">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </div>
                </div>

                <!-- Comment -->
                <div class="form-group">
                    <label class="form-label">Comments (optional)</label>
                    <textarea class="form-textarea" id="commentTextarea" placeholder="Share your thoughts on this smoke..."></textarea>
                </div>

                <button class="submit-btn" id="submitPostBtn" disabled>Publish Post</button>
            </div>
        </div>

        <!-- Profile Edit Modal -->
        <div class="modal-overlay" id="profileModalOverlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Profile</h2>
                    <button class="close-btn" id="closeProfileModalBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" class="form-select" id="profileNameInput" placeholder="Enter your name">
                </div>

                <button class="submit-btn" id="saveProfileBtn">Save Profile</button>
            </div>
        </div>
    </div>

    <script>
        // Data
        const CIGAR_DATABASE = {
            "Cohiba": [
                "Cohiba Behike 52", "Cohiba Behike 54", "Cohiba Behike 56",
                "Cohiba Esplendidos", "Cohiba Lanceros", "Cohiba Robustos",
                "Cohiba Siglo I", "Cohiba Siglo II", "Cohiba Siglo III", 
                "Cohiba Siglo IV", "Cohiba Siglo V", "Cohiba Siglo VI",
                "Cohiba Maduro 5 Genios", "Cohiba Maduro 5 Magicos", "Cohiba Maduro 5 Secretos",
                "Cohiba Piramides Extra", "Cohiba Double Corona", "Cohiba Coronas Especiales"
            ],
            "Montecristo": [
                "Montecristo No. 1", "Montecristo No. 2", "Montecristo No. 3", 
                "Montecristo No. 4", "Montecristo No. 5",
                "Montecristo Petit Edmundo", "Montecristo Edmundo", "Montecristo Double Edmundo",
                "Montecristo Open Eagle", "Montecristo Open Master", "Montecristo Open Regata",
                "Montecristo White Series Churchill", "Montecristo White Rothschild",
                "Montecristo Platinum Rothschild", "Montecristo Platinum Toro",
                "Montecristo Epic No. 2", "Montecristo 1935 Anniversary Nicaragua"
            ],
            "Padron": [
                "Padron 1926 Serie No. 1", "Padron 1926 Serie No. 2", "Padron 1926 Serie No. 6",
                "Padron 1926 Serie No. 9", "Padron 1926 Serie 40th Anniversary",
                "Padron 1926 Serie 80th Anniversary",
                "Padron 1964 Anniversary Exclusivo", "Padron 1964 Anniversary Imperial",
                "Padron 1964 Anniversary Diplomatico", "Padron 1964 Anniversary Principe",
                "Padron 2000", "Padron 3000", "Padron 4000", "Padron 5000", 
                "Padron 6000", "Padron 7000", "Padron Delicias",
                "Padron Family Reserve No. 44", "Padron Family Reserve No. 45",
                "Padron Family Reserve No. 46", "Padron Family Reserve No. 50"
            ],
            "Arturo Fuente": [
                "Opus X PerfecXion No. 4", "Opus X PerfecXion No. 5", "Opus X Reserva D'Chateau",
                "Opus X Double Corona", "Opus X Super Belicoso", "Opus X Fuente Fuente",
                "Opus X Lost City Robusto", "Opus X Lost City Toro", "Opus X Lost City Lancero",
                "Hemingway Short Story", "Hemingway Classic", "Hemingway Signature",
                "Hemingway Work of Art", "Hemingway Masterpiece", "Hemingway Between the Lines",
                "Don Carlos No. 2", "Don Carlos No. 3", "Don Carlos No. 4",
                "Don Carlos Double Robusto", "Don Carlos Belicoso", "Don Carlos Personal Reserve",
                "Añejo No. 46", "Añejo No. 48", "Añejo No. 49", "Añejo No. 50", "Añejo No. 55",
                "Gran Reserva Churchill", "Gran Reserva Double Chateau", "Gran Reserva Robusto"
            ],
            "Davidoff": [
                "Davidoff Millennium Robusto", "Davidoff Millennium Toro", "Davidoff Millennium Churchill",
                "Davidoff Nicaragua Robusto", "Davidoff Nicaragua Toro", "Davidoff Nicaragua Box Pressed",
                "Davidoff Yamasa Robusto", "Davidoff Yamasa Toro", "Davidoff Yamasa Piramides",
                "Davidoff Winston Churchill Late Hour Churchill", "Davidoff Winston Churchill Robusto",
                "Davidoff Winston Churchill Toro", "Davidoff Winston Churchill The Original",
                "Davidoff Signature 2000", "Davidoff Signature No. 2", "Davidoff Signature 6000",
                "Davidoff Grand Cru No. 2", "Davidoff Grand Cru No. 3", "Davidoff Grand Cru No. 5",
                "Davidoff Aniversario No. 2", "Davidoff Aniversario No. 3", "Davidoff Special R"
            ],
            "Romeo y Julieta": [
                "Romeo y Julieta Churchill", "Romeo y Julieta Cazadores", "Romeo y Julieta Petit Julietas",
                "Romeo y Julieta Short Churchill", "Romeo y Julieta Wide Churchill",
                "Romeo y Julieta 1875 Churchill", "Romeo y Julieta 1875 Bully", "Romeo y Julieta 1875 Cedros No. 1",
                "Romeo y Julieta Reserva Real Robusto", "Romeo y Julieta Reserva Real Churchill",
                "Romeo y Julieta House of Romeo", "Romeo y Julieta Capulet",
                "Romeo y Julieta Vintage No. 1", "Romeo y Julieta Vintage No. 2"
            ],
            "Partagas": [
                "Partagas Serie D No. 4", "Partagas Serie D No. 5", "Partagas Serie D No. 6",
                "Partagas Serie E No. 2", "Partagas Serie P No. 2",
                "Partagas Lusitanias", "Partagas 8-9-8", "Partagas Shorts",
                "Partagas Black Label Magnifico", "Partagas Black Label Gigante",
                "Partagas 1845 Extra Fuerte", "Partagas Legend", "Partagas Heritage"
            ],
            "Bolivar": [
                "Bolivar Royal Corona", "Bolivar Belicosos Finos", "Bolivar Petit Corona",
                "Bolivar Coronas Junior", "Bolivar Coronas Gigantes",
                "Bolivar Tubos No. 1", "Bolivar Tubos No. 2", "Bolivar Tubos No. 3"
            ],
            "Hoyo de Monterrey": [
                "Hoyo de Monterrey Epicure No. 1", "Hoyo de Monterrey Epicure No. 2",
                "Hoyo de Monterrey Double Corona", "Hoyo de Monterrey Le Hoyo du Roi",
                "Hoyo de Monterrey Petit Robusto", "Hoyo de Monterrey Short Hoyo Piramides",
                "Hoyo de Monterrey Excalibur No. 1", "Hoyo de Monterrey Dark Sumatra"
            ],
            "H. Upmann": [
                "H. Upmann Magnum 46", "H. Upmann Magnum 50", "H. Upmann Magnum 54",
                "H. Upmann Sir Winston", "H. Upmann Half Corona", "H. Upmann Petit Corona",
                "H. Upmann Connoisseur No. 1", "H. Upmann 1844 Reserve", "H. Upmann Vintage Cameroon"
            ],
            "Punch": [
                "Punch Punch", "Punch Double Corona", "Punch Churchill",
                "Punch Rothschild", "Punch Elite", "Punch Gran Puro",
                "Punch Rare Corojo", "Punch Signature", "Punch Grand Cru"
            ],
            "Trinidad": [
                "Trinidad Fundadores", "Trinidad Reyes", "Trinidad Vigía",
                "Trinidad Coloniales", "Trinidad Topes", "Trinidad Robustos Extra",
                "Trinidad La Trova", "Trinidad Esmeralda"
            ],
            "Diplomaticos": [
                "Diplomaticos No. 2", "Diplomaticos No. 4", "Diplomaticos No. 5",
                "Diplomaticos Bushido", "Diplomaticos Excellence"
            ],
            "San Cristobal": [
                "San Cristobal de la Habana El Principe", "San Cristobal de la Habana La Fuerza",
                "San Cristobal de la Habana El Morro", "San Cristobal de la Habana Oficios",
                "San Cristobal Revelation", "San Cristobal Elegancia"
            ],
            "Por Larrañaga": [
                "Por Larrañaga Petit Corona", "Por Larrañaga Montecarlos",
                "Por Larrañaga Panetelas", "Por Larrañaga Picadores"
            ],
            "Juan Lopez": [
                "Juan Lopez Selection No. 1", "Juan Lopez Selection No. 2",
                "Juan Lopez Petit Corona", "Juan Lopez Corona"
            ],
            "La Gloria Cubana": [
                "La Gloria Cubana Medaille D'Or No. 1", "La Gloria Cubana Medaille D'Or No. 2",
                "La Gloria Cubana Serie R No. 4", "La Gloria Cubana Serie R No. 5",
                "La Gloria Cubana Wavell", "La Gloria Cubana Artesanos de Tabaqueros"
            ],
            "Saint Luis Rey": [
                "Saint Luis Rey Regios", "Saint Luis Rey Churchill",
                "Saint Luis Rey Serie A", "Saint Luis Rey Double Corona"
            ],
            "Sancho Panza": [
                "Sancho Panza Belicosos", "Sancho Panza Molinos",
                "Sancho Panza Non Plus", "Sancho Panza Sanchos"
            ],
            "Ramon Allones": [
                "Ramon Allones Specially Selected", "Ramon Allones Gigantes",
                "Ramon Allones Small Club Coronas", "Ramon Allones 8-9-8",
                "Ramon Allones Superiores"
            ],
            "Ashton": [
                "Ashton Classic Churchill", "Ashton Classic Corona", "Ashton Classic Double R",
                "Ashton Cabinet Selection No. 1", "Ashton Cabinet Selection No. 2",
                "Ashton VSG Robusto", "Ashton VSG Churchill", "Ashton VSG Enchantment",
                "Ashton Heritage Puro Sol", "Ashton Symmetry"
            ],
            "My Father": [
                "My Father Le Bijou 1922 Torpedo", "My Father Le Bijou 1922 Churchill",
                "My Father Flor de las Antillas Toro", "My Father Flor de las Antillas Belicoso",
                "My Father No. 1", "My Father No. 4", "My Father The Judge",
                "My Father Connecticut Robusto", "My Father La Opulencia"
            ],
            "Oliva": [
                "Oliva Serie V Melanio Figurado", "Oliva Serie V Melanio Churchill",
                "Oliva Serie V Double Toro", "Oliva Serie V Torpedo",
                "Oliva Serie G Maduro Robusto", "Oliva Serie G Cameroon Churchill",
                "Oliva Serie O Robusto", "Oliva Connecticut Reserve Robusto",
                "Oliva Master Blends 3"
            ],
            "Rocky Patel": [
                "Rocky Patel Vintage 1990", "Rocky Patel Vintage 1992", "Rocky Patel Vintage 1999",
                "Rocky Patel Decade Robusto", "Rocky Patel Edge Missile",
                "Rocky Patel Sun Grown", "Rocky Patel Olde World Reserve",
                "Rocky Patel The Edge Habano", "Rocky Patel ALR"
            ],
            "Perdomo": [
                "Perdomo Habano Bourbon Barrel-Aged", "Perdomo Reserve 10th Anniversary Champagne",
                "Perdomo Lot 23", "Perdomo Small Batch", "Perdomo Gran Cru",
                "Perdomo Patriarch", "Perdomo Double Aged 12 Year Vintage"
            ],
            "Alec Bradley": [
                "Alec Bradley Prensado Churchill", "Alec Bradley Black Market",
                "Alec Bradley Tempus", "Alec Bradley Mundial",
                "Alec Bradley Magic Toast", "Alec Bradley Post Embargo"
            ],
            "Drew Estate": [
                "Liga Privada No. 9", "Liga Privada T52", "Liga Privada Unico Serie",
                "Undercrown Maduro", "Undercrown Shade", "Undercrown Sun Grown",
                "Herrera Esteli", "Herrera Esteli Habano", "Herrera Esteli Norteno",
                "Acid Kuba Kuba", "Acid Blondie", "Tabak Especial"
            ],
            "Tatuaje": [
                "Tatuaje Black Label", "Tatuaje Havana VI", "Tatuaje Fausto",
                "Tatuaje Cojonu 2003", "Tatuaje 7th Reserva", "Tatuaje Monster Series",
                "Tatuaje TAA", "Tatuaje Cabaiguan"
            ],
            "CAO": [
                "CAO Flathead", "CAO Brazilia", "CAO Italia", "CAO Colombia",
                "CAO Pilon", "CAO Nicaragua", "CAO OSA Sol", "CAO Mx2"
            ],
            "Macanudo": [
                "Macanudo Cafe", "Macanudo Maduro", "Macanudo Gold Label",
                "Macanudo Inspirado White", "Macanudo Inspirado Black",
                "Macanudo Inspirado Orange", "Macanudo Vintage", "Macanudo Cru Royale"
            ],
            "Avo": [
                "Avo Classic", "Avo XO", "Avo Syncro Nicaragua",
                "Avo Syncro South America Ritmo", "Avo Heritage", "Avo Domaine"
            ],
            "Camacho": [
                "Camacho Corojo", "Camacho Connecticut", "Camacho Ecuador",
                "Camacho Triple Maduro", "Camacho American Barrel-Aged", "Camacho Liberty"
            ],
            "Foundation": [
                "Foundation The Tabernacle", "Foundation El Güegüense",
                "Foundation Charter Oak", "Foundation Wise Man Maduro",
                "Foundation The Upsetters"
            ],
            "Crowned Heads": [
                "Crowned Heads Four Kicks", "Crowned Heads Headley Grange",
                "Crowned Heads Las Calaveras", "Crowned Heads Jericho Hill",
                "Crowned Heads Le Careme", "Crowned Heads Mil Dias"
            ],
            "RoMa Craft": [
                "RoMa Craft CroMagnon", "RoMa Craft Intemperance BA XXI",
                "RoMa Craft Aquitaine", "RoMa Craft Neanderthal",
                "RoMa Craft Wunderlust"
            ],
            "Illusione": [
                "Illusione Rothchildes", "Illusione Epernay", "Illusione Haut 10",
                "Illusione Fume D'Amour", "Illusione Original Documents"
            ]
        };

        // Load user profile from localStorage or use defaults
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
            name: "Guest User",
            avatar: "GU"
        };

        // Load posts from localStorage or start with empty array
        let posts = JSON.parse(localStorage.getItem('posts')) || [];

        // Load favorites from localStorage
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        let currentRating = 0;
        let uploadedImages = [];
        let scanMode = false;

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
            localStorage.setItem('posts', JSON.stringify(posts));
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // Get user initials for avatar
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            populateBrands();
            renderFeed();
            updateProfileUI();
            setupEventListeners();
        });

        function updateProfileUI() {
            // Update all avatar instances
            document.querySelectorAll('.profile-avatar').forEach(el => {
                el.textContent = userProfile.avatar;
            });
            
            // Update profile name
            document.querySelector('.profile-info h1').textContent = userProfile.name;
            
            // Update stats
            const myPosts = posts.filter(p => p.user === userProfile.name);
            document.getElementById('postCount').textContent = myPosts.length;
            document.getElementById('reviewCount').textContent = myPosts.length;
            document.getElementById('favoriteCount').textContent = favorites.length;
        }

        function populateBrands() {
            const brandSelect = document.getElementById('brandSelect');
            Object.keys(CIGAR_DATABASE).forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                brandSelect.appendChild(option);
            });
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('feedBtn').addEventListener('click', () => switchView('feed'));
            document.getElementById('profileBtn').addEventListener('click', () => switchView('profile'));
            
            // Search
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Modal
            document.getElementById('createPostBtn').addEventListener('click', openModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target.id === 'modalOverlay') closeModal();
            });

            // Profile editing
            document.getElementById('editProfileBtn').addEventListener('click', openProfileEditModal);
            document.getElementById('closeProfileModalBtn').addEventListener('click', closeProfileEditModal);
            document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);

            // Form
            document.getElementById('brandSelect').addEventListener('change', handleBrandChange);
            document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
            document.getElementById('submitPostBtn').addEventListener('click', createPost);
            document.getElementById('scanToggle').addEventListener('click', toggleScanMode);

            // Rating stars
            document.querySelectorAll('#ratingStars .star').forEach(star => {
                star.addEventListener('click', function() {
                    setRating(parseInt(this.dataset.rating));
                });
            });
        }

        function switchView(view) {
            const feedView = document.getElementById('feedView');
            const profileView = document.getElementById('profileView');
            const feedBtn = document.getElementById('feedBtn');
            const profileBtn = document.getElementById('profileBtn');

            if (view === 'feed') {
                feedView.classList.remove('hidden');
                profileView.classList.add('hidden');
                feedBtn.classList.add('active');
                profileBtn.classList.remove('active');
            } else {
                feedView.classList.add('hidden');
                profileView.classList.remove('hidden');
                feedBtn.classList.remove('active');
                profileBtn.classList.add('active');
            }
        }

        function renderFeed() {
            const feedView = document.getElementById('feedView');
            const filteredPosts = getFilteredPosts();
            
            if (filteredPosts.length === 0 && !currentSearchTerm) {
                feedView.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem; color: #78716C;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 1.5rem;">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        <h3 style="font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #1C1917; margin-bottom: 0.5rem;">No posts yet</h3>
                        <p style="margin-bottom: 1.5rem;">Share your first cigar experience!</p>
                        <button class="create-post-btn" onclick="document.getElementById('createPostBtn').click()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                            Create Your First Post
                        </button>
                    </div>
                `;
            } else if (filteredPosts.length === 0 && currentSearchTerm) {
                feedView.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem; color: #78716C;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 1.5rem;">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <h3 style="font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #1C1917; margin-bottom: 0.5rem;">No results found</h3>
                        <p style="margin-bottom: 1.5rem;">Try searching for a different cigar or brand</p>
                    </div>
                `;
            } else {
                feedView.innerHTML = filteredPosts.map(post => createPostHTML(post)).join('');
            }
        }

        function createPostHTML(post) {
            const starsHTML = Array(5).fill(0).map((_, i) => {
                const filled = i < Math.floor(post.rating);
                return `<svg class="star ${filled ? 'filled' : 'empty'}" width="20" height="20" viewBox="0 0 24 24" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                </svg>`;
            }).join('');

            const imagesHTML = post.images.map(img => 
                `<img src="${img}" alt="${post.cigar}" class="post-image">`
            ).join('');

            // Check if this post belongs to the current user
            const isOwnPost = post.user === userProfile.name;
            const deleteButton = isOwnPost ? `
                <button class="delete-btn" onclick="deletePost(${post.id})">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Delete
                </button>
            ` : '';

            return `
                <div class="post-card">
                    <div class="post-header">
                        <div class="user-info">
                            <div class="avatar">${post.avatar}</div>
                            <div class="user-details">
                                <h3>${post.user}</h3>
                                <div class="timestamp">${post.timestamp}</div>
                            </div>
                        </div>
                        ${deleteButton ? `<div class="post-header-actions">${deleteButton}</div>` : ''}
                    </div>
                    <div class="cigar-info">
                        <div class="cigar-name">${post.cigar}</div>
                        <div class="brand-name">${post.brand}</div>
                        <div class="star-rating">${starsHTML}</div>
                    </div>
                    ${post.comment ? `<div class="post-comment">${post.comment}</div>` : ''}
                    ${post.images.length > 0 ? `<div class="post-images">${imagesHTML}</div>` : ''}
                    <div class="post-actions">
                        <button class="action-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            ${post.likes} Likes
                        </button>
                        <button class="action-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            ${post.comments} Comments
                        </button>
                    </div>
                </div>
            `;
        }

        function openModal() {
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            resetForm();
        }

        function resetForm() {
            document.getElementById('brandSelect').value = '';
            document.getElementById('cigarSelect').value = '';
            document.getElementById('commentTextarea').value = '';
            document.getElementById('cigarGroup').classList.add('hidden');
            document.getElementById('imagePreviewGrid').classList.add('hidden');
            document.getElementById('imagePreviewGrid').innerHTML = '';
            document.getElementById('scanResult').classList.add('hidden');
            document.getElementById('scanDescription').classList.add('hidden');
            setRating(0);
            uploadedImages = [];
            scanMode = false;
            document.getElementById('scanToggle').classList.remove('active');
            updateSubmitButton();
        }

        function handleBrandChange(e) {
            const brand = e.target.value;
            const cigarGroup = document.getElementById('cigarGroup');
            const cigarSelect = document.getElementById('cigarSelect');

            if (brand) {
                cigarGroup.classList.remove('hidden');
                cigarSelect.innerHTML = '<option value="">Select a cigar...</option>';
                CIGAR_DATABASE[brand].forEach(cigar => {
                    const option = document.createElement('option');
                    option.value = cigar;
                    option.textContent = cigar;
                    cigarSelect.appendChild(option);
                });
            } else {
                cigarGroup.classList.add('hidden');
            }

            cigarSelect.addEventListener('change', updateSubmitButton);
            updateSubmitButton();
        }

        function handleImageUpload(e) {
            const files = Array.from(e.target.files).slice(0, 5);
            uploadedImages = [];
            
            const previewGrid = document.getElementById('imagePreviewGrid');
            previewGrid.innerHTML = '';
            previewGrid.classList.remove('hidden');

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push(e.target.result);
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'preview-image';
                    previewGrid.appendChild(img);
                };
                reader.readAsDataURL(file);
            });

            // Auto-scan if in scan mode
            if (scanMode && files.length > 0) {
                scanCigarBand(files[0]);
            }
        }

        function toggleScanMode() {
            scanMode = !scanMode;
            const toggle = document.getElementById('scanToggle');
            const description = document.getElementById('scanDescription');
            
            toggle.classList.toggle('active');
            if (scanMode) {
                description.classList.remove('hidden');
            } else {
                description.classList.add('hidden');
                document.getElementById('scanResult').classList.add('hidden');
            }
        }

        async function scanCigarBand(file) {
            const scanningIndicator = document.getElementById('scanningIndicator');
            const scanResult = document.getElementById('scanResult');
            
            scanningIndicator.classList.remove('hidden');
            scanResult.classList.add('hidden');

            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 2000));

            const mockResults = [
                { name: "Cohiba Behike 52", brand: "Cohiba", confidence: 0.94 },
                { name: "Padron 1926 Serie", brand: "Padron", confidence: 0.89 },
                { name: "Opus X", brand: "Arturo Fuente", confidence: 0.85 }
            ];

            const result = mockResults[Math.floor(Math.random() * mockResults.length)];
            
            scanningIndicator.classList.add('hidden');
            scanResult.classList.remove('hidden');
            scanResult.innerHTML = `
                <h3 style="font-family: Inter, sans-serif; color: #1C1917; margin-bottom: 0.5rem; font-weight: 700; font-size: 1.1rem;">
                    Match Found!
                </h3>
                <p style="font-size: 1.1rem; color: #44403C; margin-bottom: 0.5rem; font-weight: 500;">
                    ${result.name}
                </p>
                <p style="color: #78716C; font-size: 0.85rem;">
                    Confidence: ${Math.round(result.confidence * 100)}%
                </p>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: ${result.confidence * 100}%"></div>
                </div>
                <a href="https://www.google.com/search?q=${encodeURIComponent(result.name + ' cigar')}&tbm=isch" 
                   target="_blank" class="google-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Search on Google Images
                </a>
            `;

            // Auto-fill the form
            document.getElementById('brandSelect').value = result.brand;
            document.getElementById('brandSelect').dispatchEvent(new Event('change'));
            setTimeout(() => {
                document.getElementById('cigarSelect').value = result.name;
                updateSubmitButton();
            }, 100);
        }

        function setRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll('#ratingStars .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('empty');
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                    star.classList.add('empty');
                }
            });
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const cigarSelect = document.getElementById('cigarSelect');
            const submitBtn = document.getElementById('submitPostBtn');
            submitBtn.disabled = !(cigarSelect.value && currentRating > 0);
        }

        function createPost() {
            const brand = document.getElementById('brandSelect').value;
            const cigar = document.getElementById('cigarSelect').value;
            const comment = document.getElementById('commentTextarea').value;

            const newPost = {
                id: Date.now(),
                user: userProfile.name,
                avatar: userProfile.avatar,
                cigar: cigar,
                brand: brand,
                rating: currentRating,
                comment: comment,
                images: uploadedImages,
                likes: 0,
                comments: 0,
                timestamp: "Just now"
            };

            posts.unshift(newPost);
            saveData();
            renderFeed();
            updateProfileUI();
            closeModal();
            switchView('feed');
        }

        function openProfileEditModal() {
            document.getElementById('profileNameInput').value = userProfile.name;
            document.getElementById('profileModalOverlay').classList.add('active');
        }

        function closeProfileEditModal() {
            document.getElementById('profileModalOverlay').classList.remove('active');
        }

        function saveProfile() {
            const newName = document.getElementById('profileNameInput').value.trim();
            
            if (newName) {
                // Update all existing posts with the new name
                posts = posts.map(post => {
                    if (post.user === userProfile.name) {
                        return { ...post, user: newName, avatar: getInitials(newName) };
                    }
                    return post;
                });

                userProfile.name = newName;
                userProfile.avatar = getInitials(newName);
                
                saveData();
                updateProfileUI();
                renderFeed();
                closeProfileEditModal();
            }
        }

        function toggleFavorite(cigar) {
            const index = favorites.indexOf(cigar);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(cigar);
            }
            saveData();
            updateProfileUI();
        }

        // Search functionality
        let currentSearchTerm = '';

        function handleSearch(e) {
            currentSearchTerm = e.target.value.toLowerCase().trim();
            renderFeed();
        }

        function getFilteredPosts() {
            if (!currentSearchTerm) {
                return posts;
            }

            return posts.filter(post => {
                const searchableText = [
                    post.cigar,
                    post.brand,
                    post.comment,
                    post.user
                ].join(' ').toLowerCase();

                return searchableText.includes(currentSearchTerm);
            });
        }

        // Delete post functionality
        function deletePost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                posts = posts.filter(post => post.id !== postId);
                saveData();
                renderFeed();
                updateProfileUI();
            }
        }

        // Make deletePost available globally
        window.deletePost = deletePost;
    </script>
</body>
</html>